# BSL-Parser
[![Join the chat at https://gitter.im/Lead-Bullets/BSL-Parser](https://badges.gitter.im/Lead-Bullets/BSL-Parser.svg)](https://gitter.im/Lead-Bullets/BSL-Parser?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)

BSL-Parser - это парсер внутреннего языка платформы 1С:Предприятие 8

Данный проект представляет из себя набор внешних обработок для платформы 1С:Предприятие версии 8.3

Обработки совместимы с интерпретатором [OneScript](https://github.com/EvilBeaver/OneScript)

Структура репозитория:

* /docs - файлы веб-страницы проекта <https://lead-bullets.github.io/BSL-Parser>
* /gui - исходники обработки, предоставляющей графический пользовательский интерфейс к парсеру (в целях отладки)
* /img - картинки для документации
* /oscript - скрипты для проверки работы парсера на интерпретаторе [OneScript](https://github.com/EvilBeaver/OneScript)
* /plugins - исходники обработок-плагинов
* /src - исходники обработки парсера
* /prepare.ps1 - скрипт подготовки окружения для использования скриптов сборки/разборки обработок
* /common.ps1 - скрипт с общими алгоритмами
* /build.ps1 - скрипт сборки обработок с помощью конфигуратора в режиме агента
* /explode.ps1 - скрипт разборки обработок с помощью конфигуратора в режиме агента
* /temp.dt - выгрузка пустой базы, которая необходима для работы конфигуратора в режиме агента

# Системные требования

Для использования обработок необходима либо установленная платформа 1С:Предприятие версии 8.3, либо интерпретатор [OneScript](https://github.com/EvilBeaver/OneScript)

Операционная система значения не имеет. Но сборочные скрипты в текущей реализации будут работать только в Windows (эти скрипты не обязательны).

Если вы хотите принять участие в проекте, то вероятно потребуется [git](https://git-scm.com/) и аккаунт на github.

# Сборка проекта

Вы можете либо клонировать репозиторий с помощью [git](https://git-scm.com/):
```ps
git clone https://github.com/Lead-Bullets/BSL-Parser
```
либо просто скачать и распаковать zip-архив: https://github.com/Lead-Bullets/BSL-Parser/archive/master.zip

Исходники обработок в данном проекте выгружены стандартными средствами конфигуратора платформы 1С:Предприятие версии 8.3. Для сборки вы можете просто открыть файл `xml` в конфигураторе как есть и пересохранить в формате `epf`

Также можно воспользоваться скриптами на **powershell**, которые находятся в корне. Сначала нужно запустить скрипт `prepare.ps1`, который установит модуль для работы с протоколом SSH (нужен для агента конфигуратора) и развернет пустую базу в папке `/temp`. Если ошибок не возникло, то запуск скрипта больше не потребуется. После этого вы можете запустить скрипт `build.ps1`, который соберет обработки в папке `/build`. Обратную операцию можно выполнить запустив скрипт `explode.ps1`

Скрипты могут иногда не срабатывать, но повторный запуск обычно помогает :)
Пользоваться скриптами нужно **осторожно**, чтобы не потерять свои правки.

# Быстрый старт
1. Клонировать репозиторий и собрать обработки (см. выше "Сборка проекта")
2. Открыть обработку build/gui.epf в управляемом приложении любой файловой базы (обработка BSLParser.epf должна лежать рядом с gui.epf)
3. Вставить исходный код на языке 1С в поле `Source`
4. В поле `Output` выбрать `AST (tree)`
5. Нажать кнопку `Translate`
6. В поле `Result` будет выведено [AST](https://ru.wikipedia.org/wiki/%D0%90%D0%B1%D1%81%D1%82%D1%80%D0%B0%D0%BA%D1%82%D0%BD%D0%BE%D0%B5_%D1%81%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE) вашего исходного кода. Если предварительно был выставлен флаг `Location`, то двойной клик на узле в дереве будет выделять соответствующий этому узлу участок исходного кода.
7. Для запуска плагина нужно в поле `Output` выбрать `Plugin` и указать файл обработки-плагина. Затем нажать `Translate`. В поле `Result` будет выведен результат работы плагина.

**Внимание!** Режим отладки существенно снижает скорость работы парсера.

![BSL-Parser](img/1SH.png)
